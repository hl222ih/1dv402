<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="one-shift.html"/>

<polymer-element name="one-week" attributes="scheduleData weekNumber layout">
    <template>
        <link rel="stylesheet" href="one-week.css" type="text/css">
        <div id="weekSchedule" draggable="false">
            <div id="day1Schedule" draggable="true"></div>
            <div id="day2Schedule" draggable="true"></div>
            <div id="day3pt1Schedule" draggable="true"></div>
            <template repeat="{{s in shifts}}">
                <one-shift shiftData={{s}} />
            </template>
        </div>
        <div id="weekScheduleOverlay" draggable="false"></div>
    </template>
    <script>

        var DAYS_IN_A_WEEK = 7;
        var MINUTES_IN_A_DAY = 1440;
        var MINUTES_IN_AN_HOUR = 60;
        var HOURS_IN_A_DAY = 24;

        Polymer('one-week', {
            shifts: [{
                dayOfWeek: 1,
                bgColor: '#ffcc66',
                color: 'black',
                workPlaceCode: "Tg.",
                employeeCode: "RR",
                shiftCode: "A2",
                startTime: 420,
                endTime: 1020,
                week: 2,
                repeatWeek: 2
            },
            {
                dayOfWeek: 3,
                bgColor: '#ffcc66',
                color: 'black',
                workPlaceCode: "Tg.",
                employeeCode: "RR",
                shiftCode: "A1",
                startTime: 420,
                endTime: 960,
                week: 2,
                repeatWeek: 2
            }],
            pxWidth: 420,
            pxHeight: 288,
            strokeWidth: 1,
            renderSchedule: function() {

                var strokeWidth = this.strokeWidth;
                var pxWidth = this.pxWidth + 8;
                var pxHeight = this.pxHeight;
                var width = pxWidth * 5;
                var height = pxHeight * 5;
                var minuteHeight = height / MINUTES_IN_A_DAY;
                var dayWidth = (width - 40)/ DAYS_IN_A_WEEK;
                var bgDraw = SVG(this.$.weekSchedule).fixSubPixelOffset().size(pxWidth,pxHeight).viewbox(-0.5, -0.5, width, height);
                bgDraw.rect(width,height).fill('#f0f0f0');

                var draw = SVG(this.$.weekScheduleOverlay).fixSubPixelOffset().size(pxWidth,pxHeight).viewbox(-0.5,-0.5,width,height).attr({ fill: 'none', 'stroke-width': strokeWidth, stroke: 'blue'});

                var path = '' +
                            //between days lines
                        'M ' + (dayWidth + 5) + ' 0'  + ' l 0 ' + (height) + ' ' +
                        'M ' + (dayWidth * 2 + 10) + ' 0'  + ' l 0 ' + (height) + ' ' +
                        'M ' + (dayWidth * 3 + 15) + ' 0'  + ' l 0 ' + (height) + ' ' +
                        'M ' + (dayWidth * 4 + 20) + ' 0'  + ' l 0 ' + (height) + ' ' +
                        'M ' + (dayWidth * 5 + 25) + ' 0'  + ' l 0 ' + (height) + ' ' +
                        'M ' + (dayWidth * 6 + 30) + ' 0'  + ' l 0 ' + (height) + ' ' +
                            //border line
                        'M ' + 0 + ' ' + 0 + ' l ' + (width - 5) + ' 0 0 ' + (height) + ' -' + (width - 5) + ' 0 0 -' + (height) + 'Z ';
                //hour markers
                for (var hour = 1; hour < HOURS_IN_A_DAY; hour++) {
                    for (var day = 1; day <= DAYS_IN_A_WEEK; day++) {
                        path += 'M ' + ((day - 1) * dayWidth + (day - 1) * 5) + ' ' + (hour * 60 * minuteHeight) + ' l ' + (dayWidth / 30) + ' 0 ';
                        path += 'M ' + (day * dayWidth + day * 5 - dayWidth / 30) + ' ' + (hour * 60 * minuteHeight) + ' l ' + (dayWidth / 30) + ' 0 ';
                    }
                }
                draw.path(path);
            },
            ready: function() {
                this.style.display = "block";
                this.style.position = "absolute";
                this.style.left = "100px";
                this.style.top = "100px";
                this.style.width = this.pxWidth + 'px';
                this.style.height = this.pxHeight + 'px';
            },
            domReady: function() {
                this.$.weekScheduleOverlay.style.left = (this.weekNumber * 30) + "px";
                this.$.weekScheduleOverlay.style.top = (this.weekNumber * 30) + "px";
                this.$.weekSchedule.style.top = (this.weekNumber * 30) + "px";
                this.$.weekSchedule.style.left = (this.weekNumber * 30) + "px";

                this.renderSchedule();
                this.shifts.push({
                    dayOfWeek: 7,
                    bgColor: '#ffcc66',
                    color: 'black',
                    workPlaceCode: "Tg.",
                    employeeCode: "RR",
                    shiftCode: "A2",
                    startTime: 450,
                    endTime: 960,
                    week: 2,
                    repeatWeek: 2
                });
            }
        });
    </script>
</polymer-element>